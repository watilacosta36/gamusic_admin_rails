<% content_for :page_title, @challenge.title %>

<div class="max-w-6xl">
  <!-- Header -->
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6">
    <div class="flex justify-between items-start">
      <div>
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
          <%= @challenge.title %>
        </h1>
        <div class="flex flex-wrap gap-2 mb-4">
          <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-blue-100 text-blue-800">
            <%= @challenge.category_humanized %>
          </span>
          <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full 
            <%= if @challenge.difficulty == 'iniciante'
                                         'bg-green-100 text-green-800'
                else
                  @challenge.difficulty == 'intermediario' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-red-100 text-red-800'
                end %>">
            <%= @challenge.difficulty_humanized %>
          </span>
          <% if @challenge.music_key.present? %>
            <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-purple-100 text-purple-800">
              Tom: <%= @challenge.music_key %>
            </span>
          <% end %>
          <% if @challenge.tempo.present? %>
            <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full bg-gray-100 text-gray-800">
              <%= @challenge.tempo %> BPM
            </span>
          <% end %>
        </div>
        <p class="text-gray-600 dark:text-gray-400">
          Criado em <%= @challenge.created_at.strftime("%d/%m/%Y às %H:%M") %>
          por <%= @challenge.user.name %>
        </p>
      </div>
      
      <div class="flex space-x-2">
        <%= link_to "Editar", edit_challenge_path(@challenge),
            class: "bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700" %>
        <%= link_to "Excluir", challenge_path(@challenge), method: :delete,
            confirm: "Tem certeza que deseja excluir este desafio?",
            class: "bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700" %>
      </div>
    </div>
  </div>

  <!-- Descrição e Instruções -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
    <div class="lg:col-span-2">
      <% if @challenge.description.present? %>
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Descrição</h2>
          <div class="text-gray-700 dark:text-gray-300 whitespace-pre-line">
            <%= @challenge.description %>
          </div>
        </div>
      <% end %>

      <% if @challenge.instructions.present? %>
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Instruções</h2>
          <div class="text-gray-700 dark:text-gray-300 whitespace-pre-line">
            <%= @challenge.instructions %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Downloads -->
    <div>
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Downloads</h2>
        <div class="space-y-3">
          <!-- MusicXML Download (simulado - Active Storage será configurado depois) -->
          <div class="p-3 border border-gray-200 dark:border-gray-600 rounded-md">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <span class="text-2xl mr-3">🎼</span>
                <div>
                  <p class="text-sm font-medium text-gray-900 dark:text-white">
                    MusicXML
                  </p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">
                    Arquivo musical editável
                  </p>
                </div>
              </div>
              <button class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                Download
              </button>
            </div>
          </div>

          <!-- PDF Download -->
          <div class="p-3 border border-gray-200 dark:border-gray-600 rounded-md">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <span class="text-2xl mr-3">📄</span>
                <div>
                  <p class="text-sm font-medium text-gray-900 dark:text-white">
                    PDF
                  </p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">
                    Partitura para impressão
                  </p>
                </div>
              </div>
              <button class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                Download
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="bg-white dark:bg-gray-800 rounded-lg shadow">
    <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
      <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
        Visualizador de Partitura
      </h2>
    </div>

    <div class="p-6">
      <!-- Visualizador PDF -->
      <% if @challenge.pdf_file.attached? %>
        <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg"
             style="height: 600px;">
          <iframe src="<%= url_for(@challenge.pdf_file) %>"
                  width="100%"
                  height="100%"
                  class="rounded-lg"
                  style="border:none;">
          </iframe>
        </div>
      <% else %>
        <div class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg"
             style="height: 600px;">
          <div class="flex items-center justify-center h-full">
            <div class="text-center">
              <span class="text-6xl text-gray-400 dark:text-gray-500">🎼</span>
              <p class="mt-4 text-lg text-gray-600 dark:text-gray-400">
                Nenhum PDF anexado
              </p>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>


  <!-- Botões de navegação -->
  <div class="mt-6 flex justify-between">
    <%= link_to "← Voltar para Desafios", challenges_path,
        class: "bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700" %>
    
    <div class="space-x-2">
      <%= link_to "Editar Desafio", edit_challenge_path(@challenge),
          class: "bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700" %>
    </div>
  </div>
</div>